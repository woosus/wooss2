<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" id="vp" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>EURO247 – VIP=Hero Toggle · Fixed Transform</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
(function(){
  const vp=document.getElementById('vp');
  function applyDesktopScale(){
    const w=window.screen.width;
    if(w<=820){
      const target=1280, s=(w/target);
      vp.setAttribute('content',`width=${target}, initial-scale=${s.toFixed(3)}, maximum-scale=${s.toFixed(3)}, minimum-scale=${s.toFixed(3)}, user-scalable=no, viewport-fit=cover`);
      document.documentElement.classList.add('mobile-desktop');
    }else{
      vp.setAttribute('content','width=device-width, initial-scale=1, viewport-fit=cover');
      document.documentElement.classList.remove('mobile-desktop');
    }
  }
  applyDesktopScale();
  addEventListener('resize',()=>{ if(innerWidth<=820 || document.documentElement.classList.contains('mobile-desktop')) applyDesktopScale(); });
})();
</script>
<style>
html,body{overflow-x:hidden}
:root{
  --sidebar-w:240px;
  --container:1480px;
  --bg:#0f1215; --p1:#171a1f; --bd:#2a2f36; --text:#ffffff;
  --hero-h:260px;              /* JS가 좌측선 기준 자동조절(+40%) */
  --gap:10px;
  --overlay-dur:1.6s;
  --promo-row:180px; --promo-mult:1;
}
*{box-sizing:border-box} body{background:var(--bg);color:var(--text);font-family:'Noto Sans KR',ui-sans-serif,system-ui,Inter}
.ringed{box-shadow:0 0 0 1px var(--bd) inset}
.card{border:1px solid var(--bd);background:var(--p1);border-radius:14px}

/* 헤더 */
header{position:sticky;top:0;z-index:70;background:#13161B;border-bottom:1px solid var(--bd)}
.header-inner{max-width:var(--container);margin:0 auto;display:flex;align-items:center;gap:12px;height:72px;padding:0 12px}
.logo-box{width:var(--sidebar-w);display:flex;align-items:center}
.logo-img{height:70px}
.search{flex:1;display:flex;align-items:center;gap:8px;height:44px;padding:0 12px;border-radius:12px;background:var(--p1)}

/* 레이아웃 */
.layout{max-width:var(--container);margin:0 auto;display:flex;gap:16px;padding:0 12px}
aside{width:var(--sidebar-w);flex-shrink:0}
.sidebox{border:1px solid var(--bd);border-radius:12px;background:#12171c;overflow:hidden;margin-bottom:12px}
.sidebox .head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;font-weight:900;background:linear-gradient(180deg,#151b21,#11161b);cursor:pointer}
.sidebox .caret{color:#7f8e9c;transition:transform .45s}
.sidebox.open .caret{transform:rotate(180deg)}
.sidebox .body{height:0;overflow:hidden}
.menu-list{padding:10px}

/* 좌측 버튼 */
.menu-pill{position:relative;display:flex;align-items:center;justify-content:flex-start;gap:10px;height:40px;border:1px solid #2a2f36;border-radius:10px;padding:0 12px;margin-bottom:8px;background:linear-gradient(90deg,#141a20 0%,#141a20 60%,#1b2630 100%);opacity:0;transform:translateY(-6px);transition:opacity .35s,transform .35s,box-shadow .25s,border-color .25s}
.menu-pill.show{opacity:1;transform:translateY(0)}
.menu-pill:hover{border-color:#67e8f9aa;box-shadow:0 0 0 1px #67e8f955 inset,0 10px 20px rgba(0,0,0,.25)}

/* 가입/로그인/VIP/연계 */
.btn-row{display:flex;gap:8px;margin-bottom:8px}
.btn-half{flex:1;height:40px;border-radius:10px;border:1px solid #2a2f36;background:linear-gradient(180deg,#1a2b45,#132237);font-weight:800}
.btn-half.login{background:linear-gradient(180deg,#2b1733,#231327)}
.btn-vip,.btn-link{width:100%;height:40px;border-radius:10px;border:1px solid #2a2f36;font-weight:900}
.btn-vip{background:linear-gradient(180deg,#2d3a1c,#1e2812)}
.btn-link{background:linear-gradient(180deg,#153954,#0f2a42)}

/* 섹션 */
.section{margin-top:18px}

/* 히어로 */
#heroWrap{overflow:hidden}
.hero-grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:var(--gap)}
.hero-card{height:var(--hero-h);position:relative;overflow:hidden;background:linear-gradient(180deg,#1b2128,#14191e)}
.name-line{display:flex;align-items:center;gap:6px}
.tg-ico{display:inline-block;width:16px;height:16px}

/* 6 카드 */
.six-grid{display:grid;grid-template-columns:repeat(6,1fr);gap:var(--gap)}
.six-grid .card{border-radius:16px;overflow:hidden}

/* 프로모션 1+4 */
.exclusive{display:grid;grid-template-columns:repeat(12,1fr);gap:var(--gap);grid-auto-rows:calc(var(--promo-row)*var(--promo-mult))}
.excl-big{grid-column:span 6;grid-row:span 2}
.excl-small{grid-column:span 3}
.exclusive .card{position:relative;overflow:hidden;border-radius:14px;background:linear-gradient(180deg,#151b21,#11161b);box-shadow:0 0 0 1px rgba(120,160,200,.18) inset}

/* 4소켓 이미지 + 모서리 제목 */
.promo-card{padding:0;cursor:pointer;touch-action:manipulation}
.promo-holder{position:absolute;inset:0;overflow:hidden;border-radius:14px}
.promo-holder img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(.95)}
.promo-title{position:absolute;font-weight:800;font-size:16px;padding:10px 12px;text-shadow:0 2px 10px rgba(0,0,0,.6)}
.promo-title.tl{top:8px;left:12px}
.promo-title.tr{top:8px;right:12px;text-align:right}
.promo-title.bl{bottom:8px;left:12px}
.promo-title.br{bottom:8px;right:12px;text-align:right}

/* 오버레이(컨테이너 트랜스폼 공용) */
.overlay{position:fixed;inset:0;z-index:9999;pointer-events:none}
.overlay[hidden]{display:none}
.overlay .scrim{position:absolute;inset:0;background:rgba(0,0,0,.45);opacity:0}
.overlay .panel{position:absolute;width:0;height:0;background:#161a24;border:1px solid #2a2f36;border-radius:14px;transform-origin:0 0;box-shadow:0 18px 60px rgba(0,0,0,.35);overflow:hidden}
.overlay.show{pointer-events:auto}
.overlay .content{padding:16px}
.overlay .close{position:absolute;right:12px;top:10px;padding:.35rem .6rem;border-radius:.5rem;background:#0ea5e9;color:#fff;font-weight:700}

/* 가입 모달 */
.join-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);z-index:10000}
.join-modal .win{width:min(560px,92vw);background:#12161c;border:1px solid #2a2f36;border-radius:14px;padding:18px}
.join-modal .hd{display:flex;align-items:center;justify-content:space-between}
.join-modal .title{font-weight:800}
.join-modal .close{color:#cbd5e1}
</style>
</head>
<body>
<header>
  <div class="header-inner">
    <div class="logo-box"><img class="logo-img" src="assets/logo_euro247.png" alt="EURO247"></div>
    <div class="search ringed">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#8aa1b3" stroke-width="2"><path d="m21 21-4.3-4.3m0 0A7.5 7.5 0 1 0 5 5a7.5 7.5 0 0 0 11.7 11.7z"/></svg>
      <input placeholder="게임, 스튜디오, 카테고리 검색" style="flex:1;background:transparent;outline:none;color:#e5edf6"/>
    </div>
  </div>
</header>

<div class="layout">
  <aside>
    <!-- 가입/로그인 + VIP + 가입창 연계 -->
    <div class="sidebox open" id="memberBox">
      <div class="head"><span>회원</span><span class="caret">⌄</span></div>
      <div class="body">
        <div class="menu-list">
          <div class="btn-row">
            <button class="btn-half"  id="btnJoin">가입</button>
            <button class="btn-half login">로그인</button>
          </div>
          <button class="btn-vip"  id="btnVip">VIP 호출</button>
          <button class="btn-link" id="btnLinkJoin">가입창 연계</button>
        </div>
      </div>
    </div>

    <!-- 1. 프로모션 -->
    <div class="sidebox open" id="boxPromo">
      <div class="head"><span>프로모션</span><span class="caret">⌄</span></div>
      <div class="body"><div class="menu-list">
        <div class="menu-pill" data-cat="공식프로모션">공식프로모션</div>
        <div class="menu-pill" data-cat="파트너프로모션">파트너프로모션</div>
        <div class="menu-pill" data-cat="지금진행중">지금진행중</div>
        <div class="menu-pill" data-cat="프로모션참여하기">프로모션참여하기</div>
      </div></div>
    </div>

    <!-- 2. 카테고리 -->
    <div class="sidebox open" id="boxCat">
      <div class="head"><span>카테고리</span><span class="caret">⌄</span></div>
      <div class="body"><div class="menu-list">
        <div class="menu-pill" data-cat="파트너서비스">🎫 파트너서비스</div>
        <div class="menu-pill" data-cat="등급별 혜택">🧾 등급별 혜택</div>
        <div class="menu-pill" data-cat="파트너인사">🎲 파트너인사</div>
        <div class="menu-pill" data-cat="문의하기">🧩 문의하기</div>
        <div class="menu-pill" data-cat="문의">🧩 문의</div>
        <div class="menu-pill" data-cat="선호도체크" id="prefLine">⭐ 선호도체크</div>
        <div class="menu-pill" data-cat="퀴즈풀고쿠폰받기">🏛️ 퀴즈풀고쿠폰받기</div>
        <div class="menu-pill" data-cat="쿠폰신청하기">✨ 쿠폰신청하기</div>
      </div></div>
    </div>

    <!-- 3. 쿠폰 -->
    <div class="sidebox open" id="boxCF">
      <div class="head"><span>💸쿠폰💸</span><span class="caret">⌄</span></div>
      <div class="body"><div class="menu-list">
        <div class="menu-pill" data-cat="신규무료쿠폰">신규무료쿠폰</div>
        <div class="menu-pill" data-cat="주간플레이쿠폰">주간플레이쿠폰</div>
        <div class="menu-pill" data-cat="입금더블업쿠폰">입금더블업쿠폰</div>
        <div class="menu-pill" data-cat="일일플레이쿠폰">일일플레이쿠폰</div>
        <div class="menu-pill" data-cat="담당HOST쿠폰">담당HOST쿠폰</div>
        <div class="menu-pill" data-cat="돌발쿠폰 OFF">돌발쿠폰 OFF</div>
      </div></div>
    </div>
  </aside>

  <main class="flex-1 pb-16">
    <div id="mainShift">
      <!-- 히어로 (기본: 접힘) -->
      <div id="heroWrap" style="height:0;overflow:hidden">
        <div class="card p-3">
          <div class="hero-grid">
            <div class="card hero-card">
              <img src="assets/hero_left.jpg" alt="Jayme Sun (제이미 선) — Executive Host" title="Jayme Sun (제이미 선) | Executive Host" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:12px" onerror="this.style.display='none'">
              <div class="absolute left-4 bottom-3"><div class="text-xs text-neutral-300">Jayme Sun (제이미 선)</div><div class="name-line font-bold">Executive Host</div></div>
            </div>
            <div class="card hero-card">
              <img src="assets/hero_center.jpg" alt="Tom Woo (탐 우) — Mid-level Host" title="Tom Woo (탐 우) | Mid-level Host" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:12px" onerror="this.style.display='none'">
              <div class="absolute left-4 bottom-3"><div class="text-xs text-neutral-300">Tom Woo (탐 우)</div><div class="name-line font-bold">Mid-level Host</div></div>
            </div>
            <div class="card hero-card">
              <img src="assets/hero_right.jpg" alt="Jay Hong (재 홍) — Executive Host" title="Jay Hong (재 홍) | Executive Host" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:12px" onerror="this.style.display='none'">
              <div class="absolute left-4 bottom-3"><div class="text-xs text-neutral-300">Jay Hong (재 홍)</div><div class="name-line font-bold">Executive Host</div></div>
            </div>
          </div>
        </div>
      </div>

      <!-- 프로모션 그룹 -->
      <div id="promoGroup" class="section">
        <div class="exclusive">
          <!-- 빅1: 이미지 + 가입 팝업 연결 -->
          <button id="promo-big" class="card excl-big" data-img="PRO_BIG" style="position:relative;cursor:pointer">
            <div class="promo-holder"></div>
            <div class="p-5 text-left"><div class="text-lg font-bold">퀴즈만점!쿠폰만점!</div></div>
          </button>
          <!-- 4소켓: 컨테이너 트랜스폼 + 이미지 자동 로더 -->
          <button class="card excl-small promo-card" data-go="#page-official" data-img="PRO1">
            <div class="promo-holder"></div><div class="promo-title tl">공식프로모션</div>
          </button>
          <button class="card excl-small promo-card" data-go="#page-partner" data-img="PRO2">
            <div class="promo-holder"></div><div class="promo-title tr">파트너프로모션</div>
          </button>
          <button class="card excl-small promo-card" data-go="#page-now" data-img="PRO3">
            <div class="promo-holder"></div><div class="promo-title bl">지금진행중</div>
          </button>
          <button class="card excl-small promo-card" data-go="#page-join" data-img="PRO4">
            <div class="promo-holder"></div><div class="promo-title br">프로모션참여</div>
          </button>
        </div>
      </div>

      <!-- 6카드 -->
      <div class="section" id="cards6">
        <div class="six-grid">
          <div class="card"><div style="aspect-ratio:4/5;background:linear-gradient(180deg,hsl(0,70%,60%),hsl(60,50%,45%))"></div><div class="p-3"><div class="font-bold">30,000 슬롯전용쿠폰</div><div class="text-xs text-neutral-400 mt-1">사용 완료</div></div></div>
          <div class="card"><div style="aspect-ratio:4/5;background:linear-gradient(180deg,hsl(17,70%,60%),hsl(77,50%,45%))"></div><div class="p-3"><div class="font-bold">20,000 즉석쿠폰</div><div class="text-xs text-neutral-400 mt-1">3등급사용가능</div></div></div>
          <div class="card"><div style="aspect-ratio:4/5;background:linear-gradient(180deg,hsl(34,70%,60%),hsl(94,50%,45%))"></div><div class="p-3"><div class="font-bold">30,000 즉석쿠폰</div><div class="text-xs text-neutral-400 mt-1">사용 완료</div></div></div>
          <div class="card"><div style="aspect-ratio:4/5;background:linear-gradient(180deg,hsl(51,70%,60%),hsl(111,50%,45%))"></div><div class="p-3"><div class="font-bold">60,000 롤링쿠폰</div><div class="text-xs text-neutral-400 mt-1">3등급사용가능</div></div></div>
          <div class="card"><div style="aspect-ratio:4/5;background:linear-gradient(180deg,hsl(68,70%,60%),hsl(128,50%,45%))"></div><div class="p-3"><div class="font-bold">70,000 VIP쿠폰</div><div class="text-xs text-neutral-400 mt-1">사용 완료</div></div></div>
          <div class="card"><div style="aspect-ratio:4/5;background:linear-gradient(180deg,hsl(85,70%,60%),hsl(145,50%,45%))"></div><div class="p-3"><div class="font-bold">100,000 VIP쿠폰</div><div class="text-xs text-neutral-400 mt-1">사용 완료</div></div></div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- 페이지 템플릿 -->
<template id="pages">
  <section id="page-official" class="content"><h2>공식프로모션</h2><p class="text-sm text-neutral-300">이미지/상세배너 자리</p></section>
  <section id="page-partner"  class="content"><h2>파트너프로모션</h2><p class="text-sm text-neutral-300">파트너 배너/카드</p></section>
  <section id="page-now"      class="content"><h2>지금진행중</h2><p class="text-sm text-neutral-300">실시간 진행 블록</p></section>
  <section id="page-join"     class="content"><h2>프로모션참여</h2><p class="text-sm text-neutral-300">신청/연계 폼</p></section>
</template>

<!-- 오버레이 -->
<div id="overlay" class="overlay" hidden>
  <div class="scrim"></div>
  <div class="panel">
    <button id="btnClose" class="close">닫기</button>
    <div id="overlayBody" class="content"></div>
  </div>
</div>

<!-- 가입/완료 모달 -->
<div id="joinModal" class="join-modal">
  <div class="win">
    <div class="hd"><div class="title">가입창</div><button id="joinClose" class="close">✕</button></div>
    <div class="mt-3 grid gap-3">
      <input class="px-3 py-2 rounded-md bg-[#0f1318] border border-[#2a2f36]" placeholder="아이디">
      <input class="px-3 py-2 rounded-md bg-[#0f1318] border border-[#2a2f36]" placeholder="성함">
      <input class="px-3 py-2 rounded-md bg-[#0f1318] border border-[#2a2f36]" placeholder="비밀번호" type="password">
      <input class="px-3 py-2 rounded-md bg-[#0f1318] border border-[#2a2f36]" placeholder="연락처">
      <button id="joinSubmit" class="px-4 py-3 rounded-md bg-[#0ea5e9] text-white">가입완료</button>
    </div>
  </div>
</div>

<div id="joinDone" class="join-modal">
  <div class="win">
    <div class="hd"><div class="title">가입 완료</div><button id="doneClose" class="close">✕</button></div>
    <div class="mt-4 text-neutral-200 space-y-4">
      <a href="https://선물세개.com" class="text-2xl font-bold block text-center" target="_blank" rel="noopener">www.선물세개.com</a>
      <div class="text-center">가입완료하신분만! 1분선호도체크하고</div>
      <div class="flex justify-center"><button id="btnCoupon" class="px-8 py-4 rounded-md border border-yellow-400 text-yellow-200 text-xl">쿠폰받기</button></div>
      <div class="text-xs text-neutral-400 text-center">*원치 않으시면 패스하셔도 됩니다.</div>
    </div>
  </div>
</div>

<script>
/* 좌측 아코디언 + 버튼 페이드인 */
document.querySelectorAll('.sidebox').forEach(box=>{
  const head=box.querySelector('.head'), body=box.querySelector('.body');
  const pills=[...box.querySelectorAll('.menu-pill,.btn-half,.btn-vip,.btn-link')];
  function autoH(){ body.style.height='auto'; body.style.height=body.scrollHeight+'px' }
  if(box.classList.contains('open')){ autoH(); pills.forEach((p,i)=>setTimeout(()=>p.classList.add('show'), i*80)) }
  head.addEventListener('click', ()=>{
    const open=box.classList.contains('open');
    if(open){
      body.style.height=body.scrollHeight+'px';
      requestAnimationFrame(()=>{ body.style.transition='height .7s cubic-bezier(.2,.8,.2,1)'; body.style.height='0px' });
      pills.slice().reverse().forEach((p,i)=>setTimeout(()=>p.classList.remove('show'), i*50));
      body.addEventListener('transitionend', function f(){ body.style.transition=''; box.classList.remove('open'); body.removeEventListener('transitionend',f) }, {once:true});
    }else{
      box.classList.add('open'); body.style.height='0px';
      requestAnimationFrame(()=>{ const h=body.scrollHeight+'px'; body.style.transition='height .7s cubic-bezier(.2,.8,.2,1)'; body.style.height=h });
      pills.forEach((p,i)=>setTimeout(()=>p.classList.add('show'), i*110));
      body.addEventListener('transitionend', function f(){ body.style.transition=''; body.style.height='auto'; body.removeEventListener('transitionend',f) }, {once:true});
    }
  });
});

/* 히어로 높이: 좌측 '선호도체크' 하단선 기준 → 40%만 사용 */
const heroWrap=document.getElementById('heroWrap');
function alignHero(){
  const t=document.getElementById('prefLine'); if(!t) return;
  const bottom=t.getBoundingClientRect().bottom+scrollY;
  const top=heroWrap.getBoundingClientRect().top+scrollY;
  const box=heroWrap.querySelector('.card.p-3'); const cs=getComputedStyle(box);
  const pad=parseFloat(cs.paddingTop)+parseFloat(cs.paddingBottom);
  let base=Math.round(bottom-top-pad); base=Math.max(160,base);
  let h=Math.round(base*0.4);                 // ← 40% 남김
  document.documentElement.style.setProperty('--hero-h',h+'px');
}
addEventListener('load',alignHero);
addEventListener('resize',alignHero);

/* 히어로 토글 (기본: 접힘) */
function collapseHero(){
  const h=heroWrap.scrollHeight;
  heroWrap.style.height=h+'px'; heroWrap.offsetHeight;
  heroWrap.style.transition='height .7s cubic-bezier(.2,.8,.2,1)';
  heroWrap.style.height='0px';
  heroWrap.addEventListener('transitionend', function f(){ heroWrap.style.transition=''; heroWrap.removeEventListener('transitionend',f) }, {once:true});
}
function expandHero(){
  heroWrap.style.height='0px'; heroWrap.offsetHeight;
  heroWrap.style.transition='height .7s cubic-bezier(.2,.8,.2,1)';
  heroWrap.style.height=heroWrap.scrollHeight+'px';
  heroWrap.addEventListener('transitionend', function f(){ heroWrap.style.transition=''; heroWrap.style.height='auto'; heroWrap.removeEventListener('transitionend',f) }, {once:true});
}
/* 좌측 VIP 호출 버튼으로 제어, 초기 상태 = 닫힘 */
(() => {
  const btn=document.getElementById('btnVip'); if(!btn) return;
  let openState=false; // 기본 접힘
  btn.addEventListener('click',()=>{ if(openState) collapseHero(); else expandHero(); openState=!openState; });
})();

/* 고정 컨테이너 뷰(노란 박스 크기) */
let FIXED_RECT=null;
function computeFixedRect(){
  const main=document.querySelector('main.flex-1').getBoundingClientRect();
  const top=document.querySelector('#mainShift').getBoundingClientRect().top;
  const b6=document.querySelector('#cards6').getBoundingClientRect().top;
  FIXED_RECT={left:main.left,top,width:main.width,height:Math.max(100,b6-top-8)};
}
addEventListener('load',computeFixedRect);
addEventListener('resize',computeFixedRect);
function unifiedRect(){ if(!FIXED_RECT) computeFixedRect(); return FIXED_RECT; }

/* 오버레이 공통(정밀 트랜스폼) */
const overlay=document.getElementById('overlay');
const scrim=overlay.querySelector('.scrim');
const panel=overlay.querySelector('.panel');
const bodyEl=document.getElementById('overlayBody');
const btnClose=document.getElementById('btnClose');
const pages=document.getElementById('pages');
const pageMap={}; pages.content.querySelectorAll('section').forEach(s=>pageMap['#'+s.id]=s);
const DUR=parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--overlay-dur'))||1.6;
const opts={duration:DUR*1000,easing:'cubic-bezier(.2,0,.1,1)',fill:'forwards',composite:'replace'};
function frameFromRect(from,to){
  const sx=+(from.width/to.width).toFixed(4), sy=+(from.height/to.height).toFixed(4);
  const tx=+(from.left-to.left).toFixed(2),   ty=+(from.top-to.top).toFixed(2);
  return `translate3d(${tx}px,${ty}px,0) scale(${sx},${sy})`;
}
let busy=false, open=false, lastRect=null;
function openFrom(el, contentSec){
  if(busy||open) return; busy=true;
  bodyEl.innerHTML=''; bodyEl.appendChild(pageMap[contentSec].cloneNode(true));
  const toR=unifiedRect(); const fromRect=el.getBoundingClientRect(); lastRect=fromRect;
  panel.style.left=toR.left+'px'; panel.style.top=toR.top+'px'; panel.style.width=toR.width+'px'; panel.style.height=toR.height+'px';
  const from=frameFromRect(fromRect,toR);
  overlay.hidden=false; overlay.classList.add('show');
  const pa=panel.animate([{opacity:0,transform:from},{opacity:1,transform:'translate3d(0,0,0) scale(1,1)'}],opts);
  const sa=scrim.animate([{opacity:0},{opacity:1}],opts);
  Promise.all([pa.finished,sa.finished]).then(()=>{busy=false;open=true;});
}
function closeOverlay(){
  if(busy||!open) return; busy=true;
  const toR=unifiedRect(); const to=frameFromRect(lastRect,toR);
  const pa=panel.animate([{opacity:1,transform:'translate3d(0,0,0) scale(1,1)'},{opacity:0,transform:to}],opts);
  const sa=scrim.animate([{opacity:1},{opacity:0}],opts);
  Promise.all([pa.finished,sa.finished]).then(()=>{overlay.hidden=true;overlay.classList.remove('show');busy=false;open=false;});
}
btnClose.addEventListener('click',closeOverlay); scrim.addEventListener('click',closeOverlay);

/* 프로모션 카드 즉시 반응 */
document.querySelectorAll('#promoGroup .promo-card').forEach(card=>{
  card.addEventListener('pointerdown',e=>{
    e.preventDefault();
    const sec=card.getAttribute('data-go')||'#page-official';
    openFrom(card,sec);
  },{passive:false});
});

/* 좌측 하위분류: 슬라이드+페이드 */
function slideInFromLeft(title){
  if(busy||open){}
  const fake=document.createElement('section'); fake.className='content';
  fake.innerHTML=`<h2>${title}</h2><p class="text-sm text-neutral-300">콘텐츠 준비중</p>`;
  bodyEl.innerHTML=''; bodyEl.appendChild(fake);
  const toR=unifiedRect();
  panel.style.left=toR.left+'px'; panel.style.top=toR.top+'px'; panel.style.width=toR.width+'px'; panel.style.height=toR.height+'px';
  overlay.hidden=false; overlay.classList.add('show'); open=true;
  panel.animate([{opacity:0,transform:'translate3d(-30px,0,0)'},{opacity:1,transform:'translate3d(0,0,0)'}],{duration:480,easing:'cubic-bezier(.2,.8,.2,1)',fill:'forwards'});
  scrim.animate([{opacity:0},{opacity:1}],{duration:480,fill:'forwards'});
}
document.querySelectorAll('#boxCat .menu-pill, #boxPromo .menu-pill, #boxCF .menu-pill').forEach(p=>{
  p.addEventListener('click',()=>slideInFromLeft(p.dataset.cat||p.textContent.trim()));
});

/* ====== 이미지 로더: PRO*, PRO_BIG (PNG/JPG 대소문자 모두) ====== */
function loadFirstAvailable(el, base){
  const exts=['.png','.PNG','.jpg','.JPG','.jpeg','.JPEG'];
  let idx=0; const img=new Image();
  img.onload=()=>{ img.className='w-full h-full object-cover'; el.appendChild(img); };
  img.onerror=()=>{ idx++; if(idx<exts.length){ img.src=`assets/${base}${exts[idx]}`; } };
  img.src=`assets/${base}${exts[idx]}`;
}
document.querySelectorAll('[data-img]').forEach(card=>{
  const holder=card.querySelector('.promo-holder'); if(holder) loadFirstAvailable(holder, card.dataset.img);
});

/* 빅 소켓 → 가입 팝업, ‘가입창 연계’ 버튼 → 가입 팝업, ‘가입’ 버튼 → 가입 폼 */
const joinModal=document.getElementById('joinModal');
const joinDone =document.getElementById('joinDone');
function openModal(m){ m.style.display='flex'; document.body.style.overflow='hidden'; }
function closeModal(m){ m.style.display='none'; document.body.style.overflow=''; }

document.getElementById('promo-big').addEventListener('click',()=>openModal(joinDone)); // 빅소켓=연계 팝업
document.getElementById('btnLinkJoin').addEventListener('click',()=>openModal(joinDone)); // 가입창 연계 버튼
document.getElementById('btnJoin').addEventListener('click',()=>openModal(joinModal));    // 가입=가입 폼

document.getElementById('joinClose').addEventListener('click',()=>closeModal(joinModal));
document.getElementById('joinSubmit').addEventListener('click',()=>{ closeModal(joinModal); openModal(joinDone);});
document.getElementById('doneClose').addEventListener('click',()=>closeModal(joinDone));
document.getElementById('btnCoupon').addEventListener('click',()=>closeModal(joinDone));
</script>
</body>
</html>
